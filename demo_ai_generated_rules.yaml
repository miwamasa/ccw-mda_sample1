metadata:
  name: AI-Generated Transformation
  version: '1.0'
  source_ontology: http://example.org/fleet#
  target_ontology: http://example.org/fleet-emissions#
  description: Transformation rules generated by Claude AI
  generated_by: AI
  ai_model: claude-sonnet-4
constants:
  defaults:
    unknown_value: Unknown
    unknown_fuel_type: gasoline
  fuel_emission_factors:
    diesel: 2.68
    gasoline: 2.31
    lpg: 1.51
    electric: 0.0
    description: CO2 emission factors in kg-CO2 per liter of fuel
root_mapping:
  target_type: target:VehicleEmission
  target_context:
    target: http://example.org/fleet-emissions#
    xsd: http://www.w3.org/2001/XMLSchema#
field_mappings:
- source_path: vehicleid
  target_path: vehicle_id
  default: ${constants.defaults.unknown_value}
- source_path: vehicletype
  target_path: vehicle_type
  default: ${constants.defaults.unknown_value}
- source_path: licenseplate
  target_path: license_plate
  default: ${constants.defaults.unknown_value}
- source_path: organizationname
  target_path: organization_name
  default: ${constants.defaults.unknown_value}
- source_path: contactemail
  target_path: contact_email
  default: ${constants.defaults.unknown_value}
- source_path: fleetid
  target_path: report_id
  default: ${constants.defaults.unknown_value}
calculation_rules:
- name: calculate_vehicle_emissions
  description: Calculate total CO2 emissions for a vehicle based on fuel consumption
    and emission factors
  input:
    input1: $.fuel_consumptions_(array_of_consumption_records)
    input2: $.emission_factors_(lookup_table_by_fuel_type)
  formula: sum(fuel_amount * emission_factor for each fuel_consumption)
  output: carbon_emissions
- name: calculate_emission_factor
  description: Look up the emission factor for a given fuel type
  input:
    input1: $.fuel_type
  formula: constants.fuel_emission_factors[fuel_type]
  output: emission_factor
transformation_steps:
- name: transform_vehicles_to_emissions
  description: Transform each vehicle and its fuel consumption data into an emission
    record
  source: vehicles
  target: vehicle_emissions
  iteration: true
  substeps:
  - name: map_transform_vehicles_to_emissions_fields
    mapping:
    - target: vehicle_id
      source: vehicleid
    - target: vehicle_type
      source: vehicletype
    - target: license_plate
      source: licenseplate
- name: calculate_fleet_totals
  description: Calculate fleet-wide aggregate values
  source: vehicle_emissions
  target: report_summary
  iteration: true
  substeps:
  - name: map_calculate_fleet_totals_fields
    mapping:
    - target: vehicle_id
      source: vehicleid
    - target: vehicle_type
      source: vehicletype
    - target: license_plate
      source: licenseplate
- name: map_organization_info
  description: Map organization information to reporting organization
  source: fleet_info.operator
  target: reporting_organization
  iteration: true
  substeps:
  - name: map_map_organization_info_fields
    mapping:
    - target: report_id
      source: fleetid
- name: calculate_aggregations
  description: Calculate aggregated values
  aggregations:
  - name: sum_fuel_consumed
    source: s
    aggregate:
      function: sum
      field: ''
    rounding: 2
    target: ''
  - name: sum_distance_traveled
    source: s
    aggregate:
      function: sum
      field: ''
    rounding: 2
    target: ''
  - name: sum_total_emissions
    source: s
    aggregate:
      function: sum
      field: ''
    rounding: 2
    target: ''
  - name: sum_total_fuel
    source: s
    aggregate:
      function: sum
      field: ''
    rounding: 2
    target: ''
  - name: count_vehicles
    source: s
    aggregate:
      function: count
      field: ''
    rounding: 2
    target: ''
options:
  preserve_source_context: true
  case_sensitive: false
  null_handling: use_defaults
