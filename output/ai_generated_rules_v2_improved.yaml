metadata:
  name: AI-Generated Transformation
  version: '1.0'
  source_ontology: http://example.org/manufacturing#
  target_ontology: http://example.org/ghg-report#
  description: Transformation rules generated by Claude AI
  generated_by: AI
  ai_model: claude-sonnet-4
constants:
  defaults:
    unknown_value: Unknown
  emission_factors:
    electricity: 0.5
    natural_gas: 2.03
    diesel: 2.68
  scope_classification:
    scope1:
    - natural_gas
    - diesel
    - gasoline
    - fuel_oil
    - lpg
    - coal
    scope2:
    - electricity
root_mapping:
  target_type: ghg:EmissionReport
  target_context:
    ghg: http://example.org/ghg-report#
    xsd: http://www.w3.org/2001/XMLSchema#
field_mappings:
- source_path: activity_name
  target_path: emission_source
  default: ${constants.defaults.unknown_value}
- source_path: energy_type_name
  target_path: source_category
  default: ${constants.defaults.unknown_value}
calculation_rules:
- name: calculate_co2_emission
  description: Convert energy consumption to CO2 emissions
  input:
    energy_amount: $.amount
    energy_type: $.energy_type.name
  formula: energy_amount * emission_factor
  lookup:
    emission_factor:
      source: constants.emission_factors
      key: energy_type
      key_transform: lowercase_underscore
      default: 0.0
  output: co2_amount
  rounding: 2
- name: determine_scope
  description: Classify emission into Scope 1 or Scope 2
  input:
    energy_type: $.energy_type.name
  logic:
  - condition:
      key_transform: lowercase_underscore
      check: energy_type in constants.scope_classification.scope1
    output: 1
  - condition:
      key_transform: lowercase_underscore
      check: energy_type in constants.scope_classification.scope2
    output: 2
  - default: 1
  output: scope
transformation_steps:
- name: transform_activities_to_emissions
  description: Transform manufacturing activities to emission records
  source: manufacturing_activities
  target: emissions
  iteration: true
  substeps:
  - name: iterate_energy_consumptions
    description: Process each energy consumption in the activity
    source: $.energy_consumptions
    iteration: true
    mapping:
    - target: emission_source
      source: $.activity_name
      context: parent
    - target: source_category
      source: $.energy_type.name
    - target: '@type'
      calculation: determine_scope
      format: ghg:Scope{scope}Emission
    - target: co2_amount
      calculation: calculate_co2_emission
    - target: calculation_method
      fixed_value: Activity-based calculation using standard emission factors
    - target: emission_factor
      lookup:
        source: constants.emission_factors
        key: $.energy_type.name
        key_transform: lowercase_underscore
- name: create_organization_info
  description: Extract organization information
  source: manufacturing_activities
  target: reporting_organization
  iteration: false
  substeps:
  - name: map_organization_fields
    mapping:
    - target: organization_name
      source: organization.name
      default: Unknown Organization
    - target: '@type'
      fixed_value: ghg:Organization
- name: calculate_aggregations
  description: Calculate aggregated values
  aggregations:
  - name: total_emissions
    source: emissions
    aggregate:
      function: sum
      field: co2_amount
    rounding: 2
    target: total_emissions
options:
  preserve_source_context: true
  case_sensitive: false
  null_handling: use_defaults
