metadata:
  name: AI-Generated Transformation
  version: '1.0'
  source_ontology: http://example.org/manufacturing#
  target_ontology: http://example.org/ghg-report#
  description: Transformation rules generated by Claude AI
  generated_by: AI
  ai_model: claude-sonnet-4
constants:
  defaults:
    unknown_value: Unknown
  emission_factors:
    electricity: 0.4532
    natural_gas: 0.0543
    diesel: 0.0741
    coal: 0.0954
  scope_classification:
    electricity: scope2
    natural_gas: scope1
    diesel: scope1
    coal: scope1
  calculation_methods:
    electricity: EPA eGRID
    natural_gas: EPA AP-42
    diesel: IPCC Guidelines
    coal: IPCC Guidelines
root_mapping:
  target_type: target:Emission
  target_context:
    target: http://example.org/ghg-report#
    xsd: http://www.w3.org/2001/XMLSchema#
field_mappings:
- source_path: activity_name
  target_path: emission_source
  default: ${constants.defaults.unknown_value}
- source_path: facility
  target_path: source_category
  default: ${constants.defaults.unknown_value}
calculation_rules:
- name: co2_emission_calculation
  description: Calculate CO2 emissions from energy consumption
  input:
    input1: $.amount
    input2: $.energy_type_name
  formula: energy_consumption.amount * emission_factor_lookup[energy_type.energy_type_name]
  output: co2_amount
- name: reporting_period_calculation
  description: Generate reporting period from activity dates
  input:
    input1: $.start_date
    input2: $.end_date
  formula: format_date_range(min(start_date), max(end_date))
  output: reporting_period
transformation_steps:
- name: extract_energy_consumptions
  description: Extract all energy consumption records from manufacturing activities
  source: manufacturing_activities
  target: energy_consumption_records
  iteration: true
  substeps: []
- name: calculate_emissions
  description: Transform energy consumption records into emission records with CO2
    calculations
  source: energy_consumption_records
  target: emissions
  iteration: true
  substeps: []
- name: classify_by_scope
  description: Classify emissions into Scope 1 and Scope 2 based on energy type
  source: emissions
  target: scope_classified_emissions
  iteration: true
  substeps: []
- name: aggregate_totals
  description: Calculate total emissions by scope and overall total
  source: scope_classified_emissions
  target: emission_report_totals
  iteration: false
  substeps: []
- name: create_emission_report
  description: Generate final emission report with all calculated values and metadata
  source: emission_report_totals
  target: emission_report
  iteration: false
  substeps: []
- name: calculate_aggregations
  description: Calculate aggregated values
  aggregations:
  - name: total_scope1_aggregation
    source: emissions
    aggregate:
      function: sum
      field: co2_amount
    rounding: 2
    target: total_scope1
  - name: total_scope2_aggregation
    source: emissions
    aggregate:
      function: sum
      field: co2_amount
    rounding: 2
    target: total_scope2
  - name: total_emissions_aggregation
    source: emissions
    aggregate:
      function: sum
      field: co2_amount
    rounding: 2
    target: total_emissions
options:
  preserve_source_context: true
  case_sensitive: false
  null_handling: use_defaults
