metadata:
  name: AI-Generated Transformation
  version: '1.0'
  source_ontology: http://example.org/manufacturing#
  target_ontology: http://example.org/ghg-report#
  description: Transformation rules generated by Claude AI
  generated_by: AI
  ai_model: claude-sonnet-4
constants:
  defaults:
    unknown_value: Unknown
  emission_factors:
    electricity: 0.5
    natural_gas: 2.03
    diesel: 2.68
    gasoline: 2.31
    coal: 2.42
  scope_classification:
    electricity: scope2
    natural_gas: scope1
    diesel: scope1
    gasoline: scope1
root_mapping:
  target_type: ghg:EmissionReport
  target_context:
    ghg: http://example.org/ghg-report#
    xsd: http://www.w3.org/2001/XMLSchema#
field_mappings:
- source_path: activity_id
  target_path: report_id
  default: ${constants.defaults.unknown_value}
- source_path: start_date
  target_path: report_date
  default: ${constants.defaults.unknown_value}
- source_path: facility
  target_path: organization_name
  default: ${constants.defaults.unknown_value}
- source_path: energy_type_name
  target_path: source_category
  default: ${constants.defaults.unknown_value}
calculation_rules:
- name: calculate_co2_emissions
  description: Convert energy consumption to CO2 emissions
  input:
    input1: $.amount
    input2: $.energy_type.name
  formula: energy_amount Ã— emission_factor_by_type
  output: co2_amount
- name: generate_report_id
  description: Create unique report ID from activity ID
  input:
    input1: $.activity_id
    input2: $.start_date
  formula: GHG-{year}-{activity_id}
  output: report_id
- name: determine_scope
  description: Classify emission into Scope 1 or Scope 2
  input:
    energy_type: $.energy_type.name
  logic:
  - condition:
      key_transform: lowercase_underscore
      check: energy_type in constants.scope_classification.scope1
    output: 1
  - condition:
      key_transform: lowercase_underscore
      check: energy_type in constants.scope_classification.scope2
    output: 2
  - default: 1
  output: scope
transformation_steps:
- name: create_emission_report_header
  description: Create the main emission report structure
  source: manufacturing_activities[0]
  target: emission_report
  iteration: false
  substeps:
  - name: map_report_metadata
    description: Map basic report information
    field_mappings:
    - target: report_id
      source: $.activity_id
      transformation: prefix with 'GHG-2024-'
    - target: report_date
      source: $.start_date
    - target: reporting_organization.name
      source: $.facility
    - target: reporting_period
      source: $.start_date + ' to ' + $.end_date
- name: transform_activities_to_emissions
  description: Transform manufacturing activities to emission records
  source: manufacturing_activities
  target: emissions
  iteration: true
  substeps:
  - name: iterate_energy_consumptions
    description: Process each energy consumption record
    source: $.energy_consumptions
    iteration: true
    substeps:
    - name: map_emission_fields
      description: Map basic emission properties
      field_mappings:
      - target: emission_source
        source: $.activity_name
      - target: source_category
        source: $.energy_type.name
      - target: calculation_method
        value: emission_factor
    - name: calculate_co2_amount
      description: Calculate CO2 emissions from energy consumption
      calculation: calculate_co2_emissions
      inputs:
        amount: $.amount
        energy_type: $.energy_type.name
      output: co2_amount
    - name: determine_emission_type
      description: Set emission class based on energy type
      conditional_mapping:
        field: $.energy_type.name
        mappings:
          electricity:
            '@type': ghg:Scope2Emission
          natural_gas:
            '@type': ghg:Scope1Emission
          diesel:
            '@type': ghg:Scope1Emission
        default:
          '@type': ghg:Emission
- name: calculate_totals
  description: Calculate emission totals for the report
  source: emissions
  target: emission_report
  iteration: false
  substeps:
  - name: sum_scope1_emissions
    description: Calculate total Scope 1 emissions
    aggregation:
      function: sum
      filter: '@type = ''ghg:Scope1Emission'''
      field: co2_amount
      target: total_scope_1
  - name: sum_scope2_emissions
    description: Calculate total Scope 2 emissions
    aggregation:
      function: sum
      filter: '@type = ''ghg:Scope2Emission'''
      field: co2_amount
      target: total_scope_2
  - name: sum_total_emissions
    description: Calculate overall total emissions
    aggregation:
      function: sum
      field: co2_amount
      target: total_emissions
- name: calculate_aggregations
  description: Calculate aggregated values
  aggregations:
  - name: total_scope2_emissions
    source: energyconsumptions
    aggregate:
      function: sum
      field: co2_amount
    rounding: 2
    target: total_scope_2
  - name: total_emissions
    source: emissions
    aggregate:
      function: sum
      field: co2_amount
    rounding: 2
    target: total_emissions
options:
  preserve_source_context: true
  case_sensitive: false
  null_handling: use_defaults
